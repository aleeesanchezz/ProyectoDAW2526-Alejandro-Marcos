<?xml version="1.0" encoding="UTF-8"?>
<html>
<head>
<meta charset="UTF-8"/>
<title>DOCUMENTACIÃ“N COMPLETA ECOTRACK TFG</title>
<style>
body { font-family: Calibri, Arial, sans-serif; margin: 2cm; line-height: 1.5; }
h1 { font-size: 28pt; color: #2c3e50; border-bottom: 3px solid #3498db; padding: 10px 0; }
h2 { font-size: 20pt; color: #34495e; margin-top: 30px; border-left: 4px solid #3498db; padding-left: 10px; }
h3 { font-size: 14pt; color: #7f8c8d; margin-top: 15px; }
p { text-align: justify; margin: 10px 0; }
table { width: 100%; border-collapse: collapse; margin: 15px 0; }
th { background-color: #3498db; color: white; padding: 10px; text-align: left; }
td { padding: 8px; border-bottom: 1px solid #ddd; }
pre { background-color: #f4f4f4; padding: 10px; border-radius: 5px; overflow: auto; }
code { background-color: #f4f4f4; padding: 2px 4px; font-family: monospace; }
.highlight { background-color: #fff3cd; padding: 10px; border-left: 4px solid #ffc107; margin: 10px 0; }
</style>
</head>
<body>

<h1>ğŸ“š DOCUMENTACIÃ“N COMPLETA DEL PROYECTO ECOTRACK</h1>
<p><em>Trabajo de Fin de Grado - 2Âº Desarrollo de Aplicaciones Web</em></p>

<div class="highlight">
<p><strong>Autores:</strong> Alejandro SÃ¡nchez Olivera, Marcos Blasco Serrano<br/>
<strong>Curso:</strong> 2Âº DAW<br/>
<strong>Fecha:</strong> Noviembre 2025<br/>
<strong>VersiÃ³n:</strong> 1.0 - DocumentaciÃ³n para Defensa del TFG</p>
</div>

<h2>ğŸ“‹ TABLA DE CONTENIDOS</h2>
<ol>
<li>Resumen Ejecutivo</li>
<li>DescripciÃ³n del Proyecto</li>
<li>Requisitos Funcionales</li>
<li>Arquitectura General</li>
<li>Base de Datos</li>
<li>Backend - Spring Boot</li>
<li>Frontend - Angular</li>
<li>Flujos y Rutas</li>
<li>Seguridad y AutenticaciÃ³n</li>
<li>Despliegue con Docker</li>
<li>Glosario TÃ©cnico</li>
</ol>

<br/><br/>

<h2>1. RESUMEN EJECUTIVO</h2>

<h3>Â¿QuÃ© es EcoTrack?</h3>
<p>EcoTrack es una <strong>aplicaciÃ³n web para gestiÃ³n de consumos energÃ©ticos y cÃ¡lculo de huella de carbono</strong>. Permite a los usuarios registrar sus consumos de agua, luz y gas, calcular automÃ¡ticamente el COâ‚‚ generado, visualizar estadÃ­sticas mensuales y establecer objetivos de reducciÃ³n.</p>

<h3>Objetivos del Proyecto</h3>
<ul>
<li>âœ… Facilitar el registro y seguimiento de consumos energÃ©ticos</li>
<li>âœ… Calcular automÃ¡ticamente la huella de carbono</li>
<li>âœ… Mostrar visualizaciones grÃ¡ficas de datos</li>
<li>âœ… Permitir establecer y monitorear objetivos de reducciÃ³n</li>
<li>âœ… Ser escalable y seguro en producciÃ³n</li>
<li>âœ… Ser amigable e intuitivo para el usuario final</li>
</ul>

<h3>TecnologÃ­as Principales</h3>
<table>
<tr><th>Capa</th><th>TecnologÃ­a</th></tr>
<tr><td><strong>Frontend</strong></td><td>Angular 16 + TypeScript + Chart.js</td></tr>
<tr><td><strong>Backend</strong></td><td>Spring Boot 3.3.5 + Java 21 + JPA</td></tr>
<tr><td><strong>Base de Datos</strong></td><td>MySQL 8.0 + InnoDB</td></tr>
<tr><td><strong>Despliegue</strong></td><td>Docker + Docker Compose + Caddy</td></tr>
<tr><td><strong>Proxy Inverso</strong></td><td>Caddy (HTTPS automÃ¡tico)</td></tr>
</table>

<br/><br/>

<h2>2. DESCRIPCIÃ“N DEL PROYECTO</h2>

<h3>2.1 Contexto y JustificaciÃ³n</h3>
<p>En la era del cambio climÃ¡tico, es fundamental que los individuos conozcan y reduzcan su huella de carbono. EcoTrack surge como soluciÃ³n educativa y prÃ¡ctica para sensibilizar a los usuarios sobre su consumo energÃ©tico.</p>

<h3>2.2 Alcance del Proyecto</h3>
<p><strong>Dentro del Alcance:</strong></p>
<ul>
<li>Registro y autenticaciÃ³n de usuarios</li>
<li>CRUD de consumos energÃ©ticos</li>
<li>CÃ¡lculo automÃ¡tico de COâ‚‚</li>
<li>Dashboards con grÃ¡ficos</li>
<li>RecuperaciÃ³n de contraseÃ±a por email</li>
<li>ExportaciÃ³n de datos a PDF</li>
<li>Objetivo de reducciÃ³n de consumo</li>
</ul>

<p><strong>Fuera del Alcance:</strong></p>
<ul>
<li>IntegraciÃ³n con proveedores de servicios</li>
<li>MediciÃ³n automÃ¡tica de consumos</li>
<li>AnÃ¡lisis predictivo avanzado</li>
<li>App mÃ³vil</li>
</ul>

<br/><br/>

<h2>3. REQUISITOS FUNCIONALES</h2>

<h3>3.1 MÃ³dulo de AutenticaciÃ³n</h3>

<p><strong>REQ-01: Sistema de Registro</strong></p>
<ul>
<li>Validar campos requeridos</li>
<li>Verificar unicidad de usuario y email</li>
<li>Cifrar contraseÃ±a con bcrypt</li>
<li>Guardar en BD</li>
</ul>

<p><strong>REQ-02: Sistema de Login</strong></p>
<ul>
<li>Validar credenciales</li>
<li>Crear sesiÃ³n/token</li>
<li>Redirigir a inicio</li>
<li>Mantener sesiÃ³n activa</li>
</ul>

<p><strong>REQ-03: RecuperaciÃ³n de ContraseÃ±a</strong></p>
<ul>
<li>Generar cÃ³digo temporal</li>
<li>Enviar por email</li>
<li>Validar cÃ³digo</li>
<li>Permitir cambio de contraseÃ±a</li>
</ul>

<p><strong>REQ-04: Logout</strong></p>
<ul>
<li>Cerrar sesiÃ³n</li>
<li>Limpiar datos locales</li>
<li>Redirigir a login</li>
</ul>

<h3>3.2 MÃ³dulo de Consumos</h3>

<p><strong>REQ-05: Registrar Consumo</strong></p>
<ul>
<li>Formulario con 5 campos obligatorios</li>
<li>Validar datos</li>
<li>Calcular COâ‚‚ = cantidad Ã— factor</li>
<li>Guardar en BD</li>
</ul>

<p><strong>REQ-06: Listar Consumos</strong></p>
<ul>
<li>Obtener todos los consumos del usuario</li>
<li>Implementar paginaciÃ³n (20 registros/pÃ¡gina)</li>
<li>Permitir filtros por categorÃ­a y fecha</li>
<li>Mostrar en tabla ordenable</li>
</ul>

<p><strong>REQ-07: Modificar Consumo</strong></p>
<ul>
<li>Cargar datos en formulario</li>
<li>Permitir ediciÃ³n</li>
<li>Validar cambios</li>
<li>Recalcular COâ‚‚</li>
</ul>

<p><strong>REQ-08: Eliminar Consumo</strong></p>
<ul>
<li>Solicitar confirmaciÃ³n</li>
<li>Eliminar de BD</li>
<li>Actualizar estadÃ­sticas</li>
<li>Mostrar confirmaciÃ³n</li>
</ul>

<h3>3.3 MÃ³dulo de EstadÃ­sticas</h3>

<p><strong>REQ-09: Dashboard Principal</strong></p>
<ul>
<li>Calcular COâ‚‚ del mes actual</li>
<li>Mostrar grÃ¡fico circular (categorÃ­as)</li>
<li>Mostrar grÃ¡fico lÃ­nea (Ãºltimos 6 meses)</li>
<li>Mostrar total de consumos</li>
</ul>

<p><strong>REQ-10: GrÃ¡ficos Interactivos</strong></p>
<ul>
<li>Implementar Chart.js</li>
<li>Actualizar dinÃ¡micamente</li>
<li>Responsivos en mÃ³vil</li>
<li>Mostrar leyendas y valores</li>
</ul>

<h3>3.4 Requisitos No Funcionales</h3>

<p><strong>RNF-01: Rendimiento</strong> - Cargas deben completarse en &lt; 2 segundos, mÃ¡ximo 100ms de latencia en API</p>

<p><strong>RNF-02: Disponibilidad</strong> - 99.5% uptime, recuperaciÃ³n automÃ¡tica de fallos</p>

<p><strong>RNF-03: Seguridad</strong> - HTTPS obligatorio, contraseÃ±as cifradas, validaciÃ³n doble, protecciÃ³n CSRF</p>

<p><strong>RNF-04: Escalabilidad</strong> - Soportar 1000 usuarios simultÃ¡neos, BD indexada, cachÃ© en memoria</p>

<p><strong>RNF-05: Usabilidad</strong> - Interfaz intuitiva, responsive design, mensajes claros, guÃ­as de ayuda</p>

<br/><br/>

<h2>4. ARQUITECTURA GENERAL</h2>

<h3>Diagrama de Arquitectura</h3>

<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENTE - NAVEGADOR                       â”‚
â”‚              (Angular 16 SPA - TypeScript)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ HTTPS
                          â”‚ REST API
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            PROXY INVERSO (CADDY)                             â”‚
â”‚   - Certificados SSL automÃ¡tico                              â”‚
â”‚   - Enrutamiento /api â†’ Backend                              â”‚
â”‚   - Enrutamiento / â†’ Frontend                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BACKEND (Spring Boot)  â”‚  â”‚  FRONTEND (Nginx + Angular) â”‚
â”‚  - REST Controllers      â”‚  â”‚  - Rutas SPA               â”‚
â”‚  - Servicios             â”‚  â”‚  - Componentes             â”‚
â”‚  - Repositorios (JPA)    â”‚  â”‚  - Servicios HTTP          â”‚
â”‚  - LÃ³gica de negocio     â”‚  â”‚  - GrÃ¡ficos (Chart.js)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           BASE DE DATOS (MySQL 8.0)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  USUARIO  â”‚  â”‚ CONSUMO  â”‚  â”‚CATEGORIA â”‚ ...          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>

<br/><br/>

<h2>5. BASE DE DATOS</h2>

<h3>5.1 Modelo Entidad-RelaciÃ³n</h3>

<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USUARIO   â”‚         â”‚  CONSUMO   â”‚         â”‚CATEGORIA â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   1:N   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   N:1   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚ id (PK)    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ id (PK)  â”‚
â”‚ nombre      â”‚         â”‚ id_usuario â”‚         â”‚ nombre   â”‚
â”‚ apellidos   â”‚         â”‚ categoria  â”‚         â”‚ factor   â”‚
â”‚ username*   â”‚         â”‚ cantidad   â”‚         â”‚          â”‚
â”‚ password    â”‚         â”‚ unidad     â”‚         â”‚          â”‚
â”‚ email*      â”‚         â”‚ fecha      â”‚         â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ co2        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚ notas      â”‚
       â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚         1:N    â”‚OBJETIVO_REDUCCIONâ”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                        â”‚ id (PK)          â”‚
                        â”‚ id_usuario (FK)  â”‚
                        â”‚ categoria        â”‚
                        â”‚ % reduccion      â”‚
                        â”‚ fecha_limite     â”‚
                        â”‚ estado           â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

* UNIQUE
FK = Foreign Key
</pre>

<h3>5.2 Tabla: USUARIO</h3>

<p><strong>DescripciÃ³n:</strong> Almacena los datos de los usuarios registrados en la aplicaciÃ³n.</p>

<table>
<tr><th>Campo</th><th>Tipo</th><th>Nulo</th><th>Clave</th><th>DescripciÃ³n</th></tr>
<tr><td>id</td><td>INT UNSIGNED</td><td>NO</td><td>PK</td><td>Identificador Ãºnico</td></tr>
<tr><td>nombre</td><td>VARCHAR(100)</td><td>NO</td><td>-</td><td>Nombre del usuario</td></tr>
<tr><td>apellidos</td><td>VARCHAR(100)</td><td>NO</td><td>-</td><td>Apellidos del usuario</td></tr>
<tr><td>nombre_usuario</td><td>VARCHAR(50)</td><td>NO</td><td>UNIQUE</td><td>Username para login</td></tr>
<tr><td>password</td><td>VARCHAR(255)</td><td>NO</td><td>-</td><td>ContraseÃ±a cifrada (bcrypt)</td></tr>
<tr><td>email</td><td>VARCHAR(100)</td><td>NO</td><td>UNIQUE</td><td>Email del usuario</td></tr>
</table>

<h3>5.3 Tabla: CONSUMO</h3>

<p><strong>DescripciÃ³n:</strong> Registra los consumos energÃ©ticos de cada usuario.</p>

<table>
<tr><th>Campo</th><th>Tipo</th><th>Nulo</th><th>DescripciÃ³n</th></tr>
<tr><td>id</td><td>INT</td><td>NO</td><td>Identificador Ãºnico</td></tr>
<tr><td>usuario_id</td><td>INT</td><td>NO</td><td>Referencia a usuario</td></tr>
<tr><td>categoria</td><td>ENUM</td><td>NO</td><td>Agua, Electricidad, Gas</td></tr>
<tr><td>cantidad</td><td>DECIMAL(10,2)</td><td>NO</td><td>Cantidad consumida</td></tr>
<tr><td>unidad</td><td>VARCHAR(20)</td><td>NO</td><td>mÂ³, kWh, etc.</td></tr>
<tr><td>fecha</td><td>DATE</td><td>NO</td><td>Fecha del consumo</td></tr>
<tr><td>co2</td><td>DOUBLE</td><td>NO</td><td>COâ‚‚ generado en kg</td></tr>
<tr><td>notas</td><td>TEXT</td><td>SÃ</td><td>Notas adicionales</td></tr>
</table>

<h3>5.4 Factores de COâ‚‚</h3>

<table>
<tr><th>CategorÃ­a</th><th>Factor</th><th>Unidad</th></tr>
<tr><td>Agua</td><td>0.0003</td><td>kg COâ‚‚ / litro</td></tr>
<tr><td>Electricidad</td><td>0.3</td><td>kg COâ‚‚ / kWh</td></tr>
<tr><td>Gas</td><td>2.0</td><td>kg COâ‚‚ / mÂ³</td></tr>
</table>

<h3>5.5 Ãndices para OptimizaciÃ³n</h3>

<pre>
CREATE INDEX idx_consumo_usuario ON consumo(usuario_id);
CREATE INDEX idx_consumo_fecha ON consumo(fecha);
CREATE INDEX idx_consumo_categoria ON consumo(categoria);
CREATE INDEX idx_objetivo_usuario ON objetivo_reduccion(usuario_id);
</pre>

<br/><br/>

<h2>6. BACKEND - SPRING BOOT</h2>

<h3>6.1 Estructura de Carpetas</h3>

<pre>
src/main/java/com/proyecto/ecotrack_backend/
â”œâ”€â”€ EcotrackBackendApplication.java
â”œâ”€â”€ Controladores/
â”‚   â”œâ”€â”€ ControladorUsuario.java
â”‚   â”œâ”€â”€ ControladorConsumo.java
â”‚   â”œâ”€â”€ ControladorEstadistica.java
â”‚   â””â”€â”€ ControladorObjetivoReduccion.java
â”œâ”€â”€ modelos/
â”‚   â”œâ”€â”€ Usuario.java
â”‚   â”œâ”€â”€ Consumo.java
â”‚   â”œâ”€â”€ Categoria.java (Enum)
â”‚   â”œâ”€â”€ Unidad.java (Enum)
â”‚   â”œâ”€â”€ ObjetivoReduccion.java
â”‚   â””â”€â”€ PasswordResetToken.java
â”œâ”€â”€ repositorio/
â”‚   â”œâ”€â”€ UsuarioRepositorio.java
â”‚   â”œâ”€â”€ ConsumoRepositorio.java
â”‚   â”œâ”€â”€ EstadisticaRepositorio.java
â”‚   â””â”€â”€ PasswordResetTokenRepository.java
â”œâ”€â”€ servicio/
â”‚   â”œâ”€â”€ UsuarioServicio.java
â”‚   â”œâ”€â”€ UsuarioServicioImpl.java
â”‚   â”œâ”€â”€ ConsumoServicio.java
â”‚   â”œâ”€â”€ EmailService.java
â”‚   â””â”€â”€ ...
â”œâ”€â”€ seguridad/
â”‚   â””â”€â”€ ConfiguracionSeguridad.java
â”œâ”€â”€ dto/
â”‚   â””â”€â”€ ReiniciarPasswordDto.java
â””â”€â”€ excepciones/
    â”œâ”€â”€ EmailExistenteException.java
    â””â”€â”€ NombreUsuarioExistenteException.java
</pre>

<h3>6.2 Endpoints principales del Backend</h3>

<table>
<tr><th>MÃ©todo</th><th>Endpoint</th><th>DescripciÃ³n</th></tr>
<tr><td>POST</td><td>/api/usuarios</td><td>Registrar nuevo usuario</td></tr>
<tr><td>POST</td><td>/api/usuarios/login</td><td>Iniciar sesiÃ³n</td></tr>
<tr><td>POST</td><td>/api/usuarios/recuperar-password</td><td>Solicitar recuperaciÃ³n</td></tr>
<tr><td>GET</td><td>/api/consumos/{id}</td><td>Listar consumos de usuario</td></tr>
<tr><td>POST</td><td>/api/consumos</td><td>Crear consumo</td></tr>
<tr><td>PUT</td><td>/api/consumos</td><td>Modificar consumo</td></tr>
<tr><td>DELETE</td><td>/api/consumos/{id}</td><td>Eliminar consumo</td></tr>
<tr><td>GET</td><td>/api/estadisticas/{id}</td><td>Obtener estadÃ­sticas</td></tr>
</table>

<h3>6.3 Servicios Principales</h3>

<p><strong>UsuarioServicio:</strong> GestiÃ³n de usuarios, validaciÃ³n, cifrado de contraseÃ±as</p>

<p><strong>ConsumoServicio:</strong> CRUD de consumos, cÃ¡lculo de COâ‚‚, filtrados</p>

<p><strong>EstadisticaServicio:</strong> CÃ¡lculo de estadÃ­sticas, agregaciones mensuales</p>

<p><strong>EmailService:</strong> EnvÃ­o de emails (registros, recuperaciÃ³n de contraseÃ±a)</p>

<p><strong>ObjetivoReduccionServicio:</strong> GestiÃ³n de objetivos de reducciÃ³n</p>

<h3>6.4 CÃ¡lculo de COâ‚‚</h3>

<pre>
COâ‚‚ generado = cantidad Ã— factor_co2

Ejemplo:
- Agua: 100 litros Ã— 0.0003 = 0.03 kg COâ‚‚
- Electricidad: 50 kWh Ã— 0.3 = 15 kg COâ‚‚
- Gas: 10 mÂ³ Ã— 2.0 = 20 kg COâ‚‚
</pre>

<br/><br/>

<h2>7. FRONTEND - ANGULAR</h2>

<h3>7.1 Estructura de Componentes</h3>

<p><strong>Componentes de AutenticaciÃ³n:</strong></p>
<ul>
<li>LoginComponent - Formulario de login</li>
<li>RegistrarUsuarioComponent - Formulario de registro</li>
<li>AyudaPasswordComponent - Solicitud de recuperaciÃ³n</li>
<li>ReiniciarPasswordComponent - Cambio de contraseÃ±a</li>
<li>VerificarCodigoComponent - ValidaciÃ³n de cÃ³digo</li>
</ul>

<p><strong>Componentes de Consumos:</strong></p>
<ul>
<li>RegistrarConsumoComponent - Formulario para nuevo consumo</li>
<li>HistorialConsumoComponent - Listado con filtros</li>
<li>ModificarConsumoComponent - EdiciÃ³n de consumo</li>
</ul>

<p><strong>Componentes de EstadÃ­sticas:</strong></p>
<ul>
<li>DashboardsComponent - Panel principal</li>
<li>Co2ChartComponent - GrÃ¡ficos con Chart.js</li>
</ul>

<p><strong>Componentes de Objetivos:</strong></p>
<ul>
<li>RegistrarObjetivoComponent - Crear objetivo</li>
<li>ListaObjetivosComponent - Ver objetivos</li>
</ul>

<p><strong>Componentes Comunes:</strong></p>
<ul>
<li>NavbarComponent - Barra de navegaciÃ³n</li>
<li>FooterComponent - Pie de pÃ¡gina</li>
<li>MenuUsuarioComponent - MenÃº de usuario</li>
<li>PaginaPrincipalComponent - Inicio</li>
</ul>

<h3>7.2 Rutas Principales</h3>

<table>
<tr><th>Ruta</th><th>Componente</th><th>DescripciÃ³n</th></tr>
<tr><td>/</td><td>LoginComponent</td><td>Login</td></tr>
<tr><td>/usuarios/registrar</td><td>RegistrarUsuarioComponent</td><td>Registro</td></tr>
<tr><td>/inicio</td><td>PaginaPrincipalComponent</td><td>Dashboard</td></tr>
<tr><td>/registrar-consumo</td><td>RegistrarConsumoComponent</td><td>Nuevo consumo</td></tr>
<tr><td>/historial-consumo</td><td>HistorialConsumoComponent</td><td>Historial</td></tr>
<tr><td>/modificar-consumo</td><td>ModificarConsumoComponent</td><td>Editar consumo</td></tr>
<tr><td>/registrar-objetivo</td><td>RegistrarObjetivoComponent</td><td>Nuevo objetivo</td></tr>
<tr><td>/lista-objetivos</td><td>ListaObjetivosComponent</td><td>Ver objetivos</td></tr>
</table>

<h3>7.3 Servicios Angular</h3>

<p><strong>AuthService:</strong> GestiÃ³n de autenticaciÃ³n y almacenamiento de usuario</p>

<p><strong>UsuarioService:</strong> Llamadas HTTP para usuarios (login, registro, cambiar contraseÃ±a)</p>

<p><strong>ConsumoService:</strong> CRUD de consumos</p>

<p><strong>EstadisticasService:</strong> Obtener datos para grÃ¡ficos</p>

<p><strong>ObjetivoReduccionService:</strong> GestiÃ³n de objetivos</p>

<h3>7.4 Modelos/Entidades TypeScript</h3>

<p><strong>Usuario:</strong> id, nombre, apellidos, nombreUsuario, password, email</p>

<p><strong>Consumo:</strong> id, usuario_id, categoria, cantidad, unidad, fecha, co2, notas</p>

<p><strong>CategorÃ­a:</strong> Enum (Agua, Electricidad, Gas)</p>

<p><strong>ObjetivoReduccion:</strong> id, usuario_id, categoria, porcentaje_reduccion, fecha_limite, estado</p>

<h3>7.5 GrÃ¡ficos con Chart.js</h3>

<p><strong>GrÃ¡fico Circular:</strong> DistribuciÃ³n de COâ‚‚ por categorÃ­a</p>

<p><strong>GrÃ¡fico de LÃ­nea:</strong> EvoluciÃ³n de COâ‚‚ en Ãºltimos 6 meses</p>

<br/><br/>

<h2>8. FLUJOS Y RUTAS</h2>

<h3>8.1 Flujo de Registro</h3>

<pre>
1. Usuario accede a /usuarios/registrar
2. Completa formulario (nombre, apellidos, username, email, password)
3. Angular valida datos en cliente
4. POST /api/usuarios {usuario}
5. Backend valida (email Ãºnico?, username Ãºnico?)
6. Backend cifra contraseÃ±a con bcrypt
7. Guarda en BD tabla USUARIO
8. Retorna Usuario creado
9. Angular muestra confirmaciÃ³n
10. Redirige a / (Login)
</pre>

<h3>8.2 Flujo de AutenticaciÃ³n</h3>

<pre>
1. Usuario accede a / (LoginComponent)
2. Completa formulario (username, password)
3. POST /api/usuarios/login {username, password}
4. Backend busca usuario en tabla USUARIO
5. Si no existe â†’ error
6. Si existe, verifica password con bcrypt
7. Si no coincide â†’ error
8. Si coincide â†’ retorna datos del Usuario
9. Angular guarda en localStorage
10. Redirige a /inicio (Dashboard)
</pre>

<h3>8.3 Flujo de Registro de Consumo</h3>

<pre>
1. Usuario autenticado accede a /registrar-consumo
2. Completa formulario (categorÃ­a, cantidad, unidad, fecha, notas)
3. Angular valida datos
4. POST /api/consumos {consumo}
5. Backend calcula COâ‚‚: cantidad Ã— factor
6. Guarda en tabla CONSUMO
7. Retorna Consumo creado
8. Angular muestra confirmaciÃ³n
9. Redirige a /historial-consumo
</pre>

<h3>8.4 Flujo del Dashboard</h3>

<pre>
1. Usuario accede a /inicio
2. Angular obtiene ID del usuario
3. GET /api/estadisticas/{usuarioId}
4. Backend calcula:
   - COâ‚‚ total del mes actual
   - COâ‚‚ por categorÃ­a
   - COâ‚‚ Ãºltimos 6 meses
5. Retorna EstadisticasDTO
6. Angular inicializa grÃ¡ficos con Chart.js
7. Se muestra dashboard con mÃ©tricas y grÃ¡ficos
</pre>

<br/><br/>

<h2>9. SEGURIDAD Y AUTENTICACIÃ“N</h2>

<h3>9.1 Medidas de Seguridad Implementadas</h3>

<ol>
<li><strong>Cifrado de ContraseÃ±as:</strong> BCrypt con salt automÃ¡tico</li>
<li><strong>ValidaciÃ³n Doble:</strong> Cliente + Servidor</li>
<li><strong>ProtecciÃ³n CORS:</strong> Whitelist de dominios permitidos</li>
<li><strong>Unicidad de Email y Username:</strong> Restricciones en BD</li>
<li><strong>Tokens de RecuperaciÃ³n Temporal:</strong> Expiran en 15 minutos</li>
<li><strong>HTTPS Obligatorio:</strong> Configurado en Caddy</li>
<li><strong>Variables de Entorno Sensibles:</strong> Almacenadas en .env</li>
<li><strong>Guards de AutenticaciÃ³n:</strong> En rutas protegidas</li>
<li><strong>Almacenamiento Seguro:</strong> localStorage con clave de usuario</li>
</ol>

<h3>9.2 Ejemplo de Cifrado de ContraseÃ±a</h3>

<pre>
// Registrar usuario
PasswordEncoder encoder = new BCryptPasswordEncoder();
String passwordCifrada = encoder.encode("miPassword123");
// Resultado: $2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcg7b3...

// Verificar contraseÃ±a al login
boolean esValida = encoder.matches("miPassword123", passwordCifrada);
// Retorna: true
</pre>

<h3>9.3 ConfiguraciÃ³n CORS</h3>

<pre>
registry.addMapping("/api/**")
    .allowedOrigins("https://tu-dominio.duckdns.org")
    .allowedMethods("GET", "POST", "PUT", "DELETE")
    .allowCredentials(true)
    .maxAge(3600);
</pre>

<br/><br/>

<h2>10. DESPLIEGUE CON DOCKER</h2>

<h3>10.1 Componentes del Despliegue</h3>

<p><strong>4 contenedores principales:</strong></p>

<ol>
<li><strong>MySQL:</strong> Base de datos (puerto 3306)</li>
<li><strong>Backend (Spring Boot):</strong> API REST (puerto 8080)</li>
<li><strong>Frontend (Nginx):</strong> AplicaciÃ³n web (puerto 80)</li>
<li><strong>Caddy:</strong> Proxy inverso HTTPS (puertos 80, 443)</li>
</ol>

<h3>10.2 Archivo docker-compose.yml</h3>

<p>Define la orquestaciÃ³n de todos los servicios con variables de entorno, volÃºmenes, healthchecks, y networking.</p>

<h3>10.3 Pasos de Despliegue</h3>

<ol>
<li>Preparar archivo .env con variables</li>
<li>Ejecutar <code>docker-compose build</code></li>
<li>Ejecutar <code>docker-compose up -d</code></li>
<li>Esperar a que servicios estÃ©n listos</li>
<li>Acceder a https://tu-dominio.duckdns.org</li>
</ol>

<h3>10.4 Comandos Ãštiles</h3>

<pre>
# Ver estado de contenedores
docker-compose ps

# Ver logs en tiempo real
docker-compose logs -f

# Detener servicios
docker-compose down

# Reconstruir imÃ¡genes
docker-compose build --no-cache

# Backup de base de datos
docker-compose exec mysql mysqldump -u root -p ecotrack > backup.sql
</pre>

<br/><br/>

<h2>11. GLOSARIO TÃ‰CNICO</h2>

<table>
<tr><th>TÃ©rmino</th><th>DefiniciÃ³n</th></tr>
<tr><td>ACID</td><td>Atomicidad, Consistencia, Aislamiento, Durabilidad (propiedades de BD)</td></tr>
<tr><td>API REST</td><td>Interfaz que permite comunicaciÃ³n HTTP entre cliente y servidor</td></tr>
<tr><td>BCrypt</td><td>Algoritmo de cifrado de contraseÃ±as con salt automÃ¡tico</td></tr>
<tr><td>CORS</td><td>Cross-Origin Resource Sharing (permite requisiciones entre dominios)</td></tr>
<tr><td>DTO</td><td>Data Transfer Object (objeto para transferir datos entre capas)</td></tr>
<tr><td>Enum</td><td>Tipo de dato con valores predefinidos</td></tr>
<tr><td>FK</td><td>Foreign Key (clave forÃ¡nea, referencia a otra tabla)</td></tr>
<tr><td>HTTP</td><td>HyperText Transfer Protocol (protocolo de comunicaciÃ³n web)</td></tr>
<tr><td>HTTPS</td><td>HTTP Secure (HTTP con cifrado SSL/TLS)</td></tr>
<tr><td>JPA</td><td>Java Persistence API (especificaciÃ³n para acceso a BD)</td></tr>
<tr><td>JWT</td><td>JSON Web Token (token para autenticaciÃ³n stateless)</td></tr>
<tr><td>ORM</td><td>Object Relational Mapping (mapeo de objetos a BD)</td></tr>
<tr><td>PK</td><td>Primary Key (clave primaria, identificador Ãºnico)</td></tr>
<tr><td>REST</td><td>Representational State Transfer (arquitectura para APIs)</td></tr>
<tr><td>SPA</td><td>Single Page Application (aplicaciÃ³n web que carga una sola pÃ¡gina)</td></tr>
<tr><td>SQL</td><td>Structured Query Language (lenguaje para BD)</td></tr>
<tr><td>SSL/TLS</td><td>Secure Sockets Layer / Transport Layer Security (cifrado web)</td></tr>
<tr><td>UUID</td><td>Universally Unique Identifier (identificador Ãºnico universal)</td></tr>
</table>

<br/><br/>

<h2>CONCLUSIÃ“N</h2>

<p>EcoTrack es un proyecto completo de aplicaciÃ³n web que demuestra:</p>

<ul>
<li>âœ… <strong>Arquitectura moderna</strong> con separaciÃ³n de capas</li>
<li>âœ… <strong>TecnologÃ­as actuales</strong> (Angular, Spring Boot, MySQL, Docker)</li>
<li>âœ… <strong>Seguridad</strong> con cifrado y validaciÃ³n</li>
<li>âœ… <strong>Base de datos relacional</strong> con integridad referencial</li>
<li>âœ… <strong>Despliegue en producciÃ³n</strong> con Docker y HTTPS</li>
<li>âœ… <strong>Funcionalidades completas</strong> desde autenticaciÃ³n hasta grÃ¡ficos</li>
</ul>

<p><strong>Este proyecto es apto para ser presentado como TFG en un programa de 2Âº DAW.</strong></p>

<div style="margin-top: 50px; padding-top: 20px; border-top: 2px solid #ddd; text-align: center; color: #7f8c8d; font-size: 0.9em;">
<p>Generado: Enero 2026</p>
<p>Para la defensa del TFG</p>
</div>

</body>
</html>
